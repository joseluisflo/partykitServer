name = "partykit"
main = "src/party/main.ts"
compatibility_date = "2024-07-25"

# Habilita la compatibilidad con APIs de Node.js, necesario para firebase-admin
compatibility_flags = ["nodejs_compat"]

[[durable_objects.bindings]]
name = "PARTYKIT_DURABLE"
class_name = "PartyKitDurable"

# Enlaza la variable secreta configurada en el dashboard de Cloudflare
[secrets]
FIREBASE_SERVICE_ACCOUNT = "FIREBASE_SERVICE_ACCOUNT"
GEMINI_API_KEY = "GEMINI_API_KEY"

# Regla de enrutamiento para asegurar que las peticiones se dirijan al Durable Object
[[rules]]
type = "ESModule"
globs = ["**/*.js", "**/*.mjs"]
fallthrough = true

[[rules]]
type = "Data"
globs = ["**/*.wasm", "**/*.bin", "**/*.html"]
fallthrough = true
